#!/usr/bin/env node

const fs = require('fs');
const path = require('path');

// Simple emoji regex
const EMOJI_REGEX = /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|‚úÖ|‚ùå|üéØ|üîß|üìä|üöÄ|‚ö†Ô∏è|üîç|üìã|üí°|üéâ|üö®|üìà|üìâ|üîÑ|‚≠ê|üè∑Ô∏è|üìù|üîó|üì±|üíª|üñ•Ô∏è|‚ö°|üõ†Ô∏è|üé®|üì¶|üîí|üåê|üìû|üéì|ü§ñ|üë•|üìö|üî•|üíé|üé™|üé≠|üé®|üéØ|üé≤|üé≥|üéÆ|üé∞|üé±|üé∏|üéπ|üé∫|üéª|üéº|üéµ|üé∂|üé§|üéß|üìª|üì∫|üìπ|üì∑|üì∏|üìº|üíø|üíæ|üíΩ|üñ®Ô∏è|‚å®Ô∏è|üñ±Ô∏è|üñ≤Ô∏è|üí°|üî¶|üïØÔ∏è|ü™î|üîã|üîå|üíª|üñ•Ô∏è|üñ®Ô∏è|‚å®Ô∏è|üñ±Ô∏è|üñ≤Ô∏è|üíΩ|üíæ|üíø|üìÄ|üßÆ|üé•|üéûÔ∏è|üìΩÔ∏è|üé¨|üì∫|üì∑|üì∏|üìπ|üìº|üîç|üîé|üïØÔ∏è|üí°|üî¶|üèÆ|ü™î|üìî|üìï|üìñ|üìó|üìò|üìô|üìö|üìì|üìí|üìÉ|üìú|üìÑ|üì∞|üóûÔ∏è|üìë|üîñ|üè∑Ô∏è|üí∞|üí¥|üíµ|üí∂|üí∑|üí∏|üí≥|üßæ|üíπ|üí±|üí≤|‚úâÔ∏è|üìß|üì®|üì©|üì§|üì•|üì¶|üì´|üì™|üì¨|üì≠|üìÆ|üó≥Ô∏è|‚úèÔ∏è|‚úíÔ∏è|üñãÔ∏è|üñäÔ∏è|üñåÔ∏è|üñçÔ∏è|üìù|üíº|üìÅ|üìÇ|üóÇÔ∏è|üìÖ|üìÜ|üóíÔ∏è|üóìÔ∏è|üìá|üìà|üìâ|üìä|üìã|üìå|üìç|üìé|üñáÔ∏è|üìè|üìê|‚úÇÔ∏è|üóÉÔ∏è|üóÑÔ∏è|üóëÔ∏è|üîí|üîì|üîè|üîê|üîë|üóùÔ∏è|üî®|ü™ì|‚õèÔ∏è|‚öíÔ∏è|üõ†Ô∏è|üó°Ô∏è|‚öîÔ∏è|üî´|ü™É|üèπ|üõ°Ô∏è|ü™ö|üîß|ü™õ|üî©|‚öôÔ∏è|üóúÔ∏è|‚öñÔ∏è|ü¶Ø|üîó|‚õìÔ∏è|ü™ù|üß∞|üß≤|ü™ú|‚öóÔ∏è|üß™|üß´|üß¨|üî¨|üî≠|üì°|üíâ|ü©∏|üíä|ü©π|ü©∫|üö™|üõó|ü™ü|ü™ë|üõèÔ∏è|üõãÔ∏è|ü™ë|üöΩ|ü™†|üöø|üõÅ|ü™§|ü™í|üß¥|üß∑|üßπ|üß∫|üßª|ü™£|üßº|ü™•|üßΩ|üßØ|üõí|üö¨|‚ö∞Ô∏è|ü™¶|‚ö±Ô∏è|üóø|ü™ß|üèß|üöÆ|üö∞|‚ôø|üöπ|üö∫|üöª|üöº|üöæ|üõÇ|üõÉ|üõÑ|üõÖ|‚ö†Ô∏è|üö∏|‚õî|üö´|üö≥|üö≠|üöØ|üö±|üö∑|üìµ|üîû|‚ò¢Ô∏è|‚ò£Ô∏è|‚¨ÜÔ∏è|‚ÜóÔ∏è|‚û°Ô∏è|‚ÜòÔ∏è|‚¨áÔ∏è|‚ÜôÔ∏è|‚¨ÖÔ∏è|‚ÜñÔ∏è|‚ÜïÔ∏è|‚ÜîÔ∏è|‚Ü©Ô∏è|‚Ü™Ô∏è|‚§¥Ô∏è|‚§µÔ∏è|üîÉ|üîÑ|üîô|üîö|üîõ|üîú|üîù|üõê|‚öõÔ∏è|üïâÔ∏è|‚ú°Ô∏è|‚ò∏Ô∏è|‚òØÔ∏è|‚úùÔ∏è|‚ò¶Ô∏è|‚ò™Ô∏è|‚òÆÔ∏è|üïé|üîØ|‚ôà|‚ôâ|‚ôä|‚ôã|‚ôå|‚ôç|‚ôé|‚ôè|‚ôê|‚ôë|‚ôí|‚ôì|‚õé|üîÄ|üîÅ|üîÇ|‚ñ∂Ô∏è|‚è©|‚è≠Ô∏è|‚èØÔ∏è|‚óÄÔ∏è|‚è™|‚èÆÔ∏è|üîº|‚è´|üîΩ|‚è¨|‚è∏Ô∏è|‚èπÔ∏è|‚è∫Ô∏è|‚èèÔ∏è|üé¶|üîÖ|üîÜ|üì∂|üì≥|üì¥|‚ôÄÔ∏è|‚ôÇÔ∏è|‚ößÔ∏è|‚úñÔ∏è|‚ûï|‚ûñ|‚ûó|‚ôæÔ∏è|‚ÄºÔ∏è|‚ÅâÔ∏è|‚ùì|‚ùî|‚ùï|‚ùó|„Ä∞Ô∏è|üí±|üí≤|‚öïÔ∏è|‚ôªÔ∏è|‚öúÔ∏è|üî±|üìõ|üî∞|‚≠ï|‚úÖ|‚òëÔ∏è|‚úîÔ∏è|‚ùå|‚ùé|‚û∞|‚ûø|„ÄΩÔ∏è|‚ú≥Ô∏è|‚ú¥Ô∏è|‚ùáÔ∏è|¬©Ô∏è|¬ÆÔ∏è|‚Ñ¢Ô∏è|#Ô∏è‚É£|*Ô∏è‚É£|0Ô∏è‚É£|1Ô∏è‚É£|2Ô∏è‚É£|3Ô∏è‚É£|4Ô∏è‚É£|5Ô∏è‚É£|6Ô∏è‚É£|7Ô∏è‚É£|8Ô∏è‚É£|9Ô∏è‚É£|üîü|üî†|üî°|üî¢|üî£|üî§|üÖ∞Ô∏è|üÜé|üÖ±Ô∏è|üÜë|üÜí|üÜì|‚ÑπÔ∏è|üÜî|‚ìÇÔ∏è|üÜï|üÜñ|üÖæÔ∏è|üÜó|üÖøÔ∏è|üÜò|üÜô|üÜö|üàÅ|üàÇÔ∏è|üà∑Ô∏è|üà∂|üàØ|üâê|üàπ|üàö|üà≤|üâë|üà∏|üà¥|üà≥|„äóÔ∏è|„äôÔ∏è|üà∫|üàµ|üî¥|üü†|üü°|üü¢|üîµ|üü£|üü§|‚ö´|‚ö™|üü•|üüß|üü®|üü©|üü¶|üü™|üü´|‚¨õ|‚¨ú|‚óºÔ∏è|‚óªÔ∏è|‚óæ|‚óΩ|‚ñ™Ô∏è|‚ñ´Ô∏è|üî∂|üî∑|üî∏|üîπ|üî∫|üîª|üí†|üîò|üî≥|üî≤|üèÅ|üö©|üéå|üè¥|üè≥Ô∏è|üè≥Ô∏è‚Äçüåà|üè≥Ô∏è‚Äç‚ößÔ∏è|üè¥‚Äç‚ò†Ô∏è/gu;

function scanFile(filePath) {
  try {
    const content = fs.readFileSync(filePath, 'utf8');
    const emojis = content.match(EMOJI_REGEX);
    
    if (emojis) {
      console.log(`‚ùå EMOJIS FOUND in ${filePath}:`);
      console.log(`   Count: ${emojis.length}`);
      console.log(`   Emojis: ${[...new Set(emojis)].join(' ')}`);
      
      // Show first few lines with emojis
      const lines = content.split('\n');
      lines.forEach((line, index) => {
        if (emojis.some(emoji => line.includes(emoji))) {
          console.log(`   Line ${index + 1}: ${line.substring(0, 100)}...`);
        }
      });
      console.log('');
      return false;
    }
    return true;
  } catch (error) {
    return true; // Skip files that can't be read
  }
}

function scanDirectory(dir) {
  let allClean = true;
  
  try {
    const items = fs.readdirSync(dir);
    
    for (const item of items) {
      const fullPath = path.join(dir, item);
      
      // Skip hidden files and node_modules
      if (item.startsWith('.') && item !== '.github') continue;
      if (item === 'node_modules') continue;
      if (item === 'dist') continue;
      
      try {
        const stat = fs.statSync(fullPath);
        
        if (stat.isDirectory()) {
          if (!scanDirectory(fullPath)) {
            allClean = false;
          }
        } else if (stat.isFile() && fullPath.endsWith('.md')) {
          if (!scanFile(fullPath)) {
            allClean = false;
          }
        }
      } catch (error) {
        // Skip files/dirs that can't be accessed
      }
    }
  } catch (error) {
    // Skip directories that can't be read
  }
  
  return allClean;
}

console.log('üîç Scanning for emojis in .md files...\n');

const isClean = scanDirectory('.');

console.log('\n' + '='.repeat(60));
if (isClean) {
  console.log('‚úÖ NO EMOJIS FOUND in .md files');
} else {
  console.log('‚ùå EMOJIS FOUND in .md files - VIOLATION!');
}
console.log('='.repeat(60));

process.exit(isClean ? 0 : 1);
