---
/**
 * ThemeToggle Component - Button to switch between light and dark theme
 * Integrated with TypeScript theme system
 */

import Icon from './Icon.astro';

interface Props {
  size?: 'sm' | 'md' | 'lg';
  className?: string;
  showLabel?: boolean;
}

const {
  size = 'md',
  className = '',
  showLabel = false
} = Astro.props;

// Mapeo de tama√±os
const sizeClasses = {
  sm: 'p-1.5',
  md: 'p-2',
  lg: 'p-3'
};

const iconSizes = {
  sm: 16,
  md: 20,
  lg: 24
};
---

<button
  id="theme-toggle"
  type="button"
  class={`theme-toggle-btn inline-flex items-center justify-center rounded-lg bg-button hover:bg-button-hover text-content hover:text-primary transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-card ${sizeClasses[size]} ${className}`}
  aria-label="Toggle theme"
  title="Toggle theme"
>
  <!-- Light theme icon (visible in dark mode) -->
  <span class="theme-icon-light hidden dark:inline-flex">
    <Icon name="sun" size={iconSizes[size]} />
  </span>

  <!-- Dark theme icon (visible in light mode) -->
  <span class="theme-icon-dark inline-flex dark:hidden">
    <Icon name="moon" size={iconSizes[size]} />
  </span>

  {showLabel && (
    <span class="ml-2 text-sm font-medium">
      <span class="theme-label-light hidden dark:inline">Light</span>
      <span class="theme-label-dark inline dark:hidden">Dark</span>
    </span>
  )}
</button>

<script>
  import { themeManager } from '../../utils/theme.ts';

  // Function to initialize theme toggle
  function initThemeToggle() {
    const toggleButton = document.getElementById('theme-toggle');

    if (!toggleButton) {
      console.warn('Theme toggle button not found');
      return;
    }

    // Handle button click
    toggleButton.addEventListener('click', () => {
      themeManager.toggleTheme();
    });

    // Subscribe to theme changes to update visual state
    themeManager.subscribe((theme) => {
      // Update aria-label dynamically
      const newLabel = theme === 'dark' ? 'Switch to light theme' : 'Switch to dark theme';
      toggleButton.setAttribute('aria-label', newLabel);
      toggleButton.setAttribute('title', newLabel);
    });

    // Initialize theme
    themeManager.init();
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initThemeToggle);
  } else {
    initThemeToggle();
  }

  // Re-initialize on SPA navigation (if applicable)
  document.addEventListener('astro:page-load', initThemeToggle);
</script>

<style>
  /* Additional styles for smooth transitions */
  .theme-toggle-btn {
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .theme-toggle-btn:hover {
    transform: translateY(-1px);
  }

  .theme-toggle-btn:active {
    transform: translateY(0);
  }

  /* Smooth animation for icon changes */
  .theme-icon-light,
  .theme-icon-dark {
    transition: opacity 0.2s ease-in-out;
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .theme-toggle-btn {
      transition: none;
      transform: none !important;
    }

    .theme-icon-light,
    .theme-icon-dark {
      transition: none;
    }
  }
</style>
