---
import type { ExperienceItem } from './types';

interface Props {
  experience: ExperienceItem;
  className?: string;
}

const { experience, className = '' } = Astro.props;

// Helper function to format technologies list
const formatTechnologies = (technologies: string[]): string[] => {
  return technologies.map(tech => tech.trim());
};

// Helper function to format responsibilities list
const formatResponsibilities = (responsibilities: string[]): string[] => {
  return responsibilities.map(resp => resp.trim());
};

const formattedTechnologies = formatTechnologies(experience.technologies);
const formattedResponsibilities = formatResponsibilities(experience.responsibilities);
---

<div class={`card-base p-4 sm:p-6 ${className}`}>
  <!-- Company and Position Header -->
  <header class="mb-4">
    <h3 class="text-xl sm:text-2xl font-bold mb-2 text-primary">
      {experience.website ? (
        <a
          href={experience.website}
          target="_blank"
          rel="noopener noreferrer"
          class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors"
          aria-label={`Visit ${experience.company} website`}
        >
          {experience.company}
          <span class="ml-1 text-sm">‚Üó</span>
        </a>
      ) : (
        experience.company
      )}
    </h3>

    <h4 class="text-lg sm:text-xl mb-2 text-secondary">
      {experience.position}
      {experience.current && (
        <span class="ml-2 inline-flex items-center px-2 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded-full">
          Current
        </span>
      )}
    </h4>

    <p class="mb-4 text-muted">
      {experience.period}
      {experience.location && (
        <span class="ml-2">| {experience.location}</span>
      )}
    </p>
  </header>

  <!-- Description (if available) -->
  {experience.description && (
    <div class="mb-4">
      <p class="text-secondary leading-relaxed">
        {experience.description}
      </p>
    </div>
  )}

  <!-- Technologies Section -->
  {formattedTechnologies.length > 0 && (
    <div class="mb-4">
      <h5 class="font-bold mb-2 flex items-center text-primary">
        <span class="mr-2">üõ†Ô∏è</span>
        Technologies and Tools:
      </h5>
      <ul class="list-disc pl-5 space-y-1 text-secondary">
        {formattedTechnologies.map(tech => (
          <li class="leading-relaxed">{tech}</li>
        ))}
      </ul>
    </div>
  )}

  <!-- Responsibilities Section -->
  {formattedResponsibilities.length > 0 && (
    <div>
      <h5 class="font-bold mb-2 flex items-center text-primary">
        <span class="mr-2">üéØ</span>
        Responsibilities and Achievements:
      </h5>
      <ul class="list-disc pl-5 space-y-1 text-secondary">
        {formattedResponsibilities.map(responsibility => (
          <li class="leading-relaxed">{responsibility}</li>
        ))}
      </ul>
    </div>
  )}
</div>
