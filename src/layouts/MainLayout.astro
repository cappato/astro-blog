---
import '../styles/global.css';
import CommonScripts from '../components/layout/CommonScripts.astro';
import Favicons from '../components/seo/Favicons.astro';
import Navbar from '../components/layout/Navbar.astro';
import Footer from '../components/layout/Footer.astro';
import SEOHead from '../components/seo/SEOHead.astro';
import AIMetadata from '../components/seo/AIMetadata.astro';

interface Props {
    title: string;
    description?: string;
    image?: string;
    imageAlt?: string;
    type?: 'website' | 'article';
    keywords?: string[];
    publishedDate?: string;
    modifiedDate?: string;
}

const {
    title,
    description = "Mat√≠as Cappato - Desarrollador web especializado en crear experiencias digitales modernas y accesibles.",
    image,
    imageAlt,
    type = 'website',
    keywords = [],
    publishedDate,
    modifiedDate
} = Astro.props;

// Convertir fechas a objetos Date si son strings
const pubDate = publishedDate ? new Date(publishedDate) : undefined;
const modDate = modifiedDate ? new Date(modifiedDate) : undefined;

const currentUrl = Astro.url.pathname;
---

<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Script de tema temprano para evitar flash -->
    <script is:inline>
      (function() {
        'use strict';
        const STORAGE_KEY = 'theme-preference';

        function getInitialTheme() {
          try {
            const savedTheme = localStorage.getItem(STORAGE_KEY);
            if (savedTheme === 'light' || savedTheme === 'dark') {
              return savedTheme;
            }
          } catch (e) {
            console.warn('localStorage no disponible para tema');
          }

          if (typeof window !== 'undefined' && window.matchMedia) {
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
              return 'dark';
            }
          }

          return 'light';
        }

        function applyTheme(theme) {
          const html = document.documentElement;
          if (theme === 'dark') {
            html.classList.add('dark');
          } else {
            html.classList.remove('dark');
          }
          html.style.colorScheme = theme;
          try {
            localStorage.setItem(STORAGE_KEY, theme);
          } catch (e) {
            console.warn('No se pudo guardar tema:', e);
          }
        }

        const initialTheme = getInitialTheme();
        applyTheme(initialTheme);
        document.documentElement.style.colorScheme = initialTheme;
        window.__THEME_INITIAL__ = initialTheme;
      })();
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    <SEOHead
        title={title}
        description={description}
        image={image}
        imageAlt={imageAlt}
        type={type}
        keywords={keywords}
        publishedDate={pubDate}
        modifiedDate={modDate}
    />
    <AIMetadata
        title={title}
        description={description}
        type={type}
        url={currentUrl}
        datePublished={pubDate}
        dateModified={modDate}
        tags={keywords}
    />
    <Favicons />
    <CommonScripts />
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 font-sans overflow-x-hidden min-h-screen transition-colors duration-300">
    <Navbar />
    <slot />
    <Footer />
</body>
</html>












