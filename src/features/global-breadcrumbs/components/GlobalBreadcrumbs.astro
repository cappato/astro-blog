---
/**
 * Global Breadcrumbs - Ultra Simplified
 */

interface Props {
  customTitle?: string;
}

interface BreadcrumbItem {
  label: string;
  href?: string;
  current?: boolean;
  icon?: string;
}

const { customTitle } = Astro.props;
const pathname = Astro.url.pathname;
const breadcrumbs: BreadcrumbItem[] = [];

// DEBUG: Comentado para testing limpio
// if (import.meta.env.DEV) {
//   console.log('üß≠ BREADCRUMB DEBUG:', { pathname, customTitle });
// }

// Home
if (pathname !== '/') {
  breadcrumbs.push({ label: 'Inicio', href: '/', icon: 'üè†' });
}

// Blog routes - L√ìGICA CORREGIDA CON PILARES
if (pathname.startsWith('/blog')) {
  // Primero manejar casos espec√≠ficos
  if (pathname === '/blog') {
    // P√°gina principal del blog
    breadcrumbs.push({ label: 'Blog', current: true, icon: 'üìù' });
  } else if (pathname === '/blog/pillars') {
    // P√°gina de pilares
    breadcrumbs.push({ label: 'Blog', href: '/blog', icon: 'üìù' });
    breadcrumbs.push({ label: 'Pilares de Contenido', current: true, icon: 'üìö' });
  } else if (pathname.startsWith('/blog/pillar/')) {
    // P√°ginas de pilares individuales
    breadcrumbs.push({ label: 'Blog', href: '/blog', icon: 'üìù' });
    breadcrumbs.push({ label: 'Pilares de Contenido', href: '/blog/pillars', icon: 'üìö' });
    breadcrumbs.push({ label: customTitle || 'Pilar', current: true, icon: 'üìñ' });
  } else if (pathname.startsWith('/blog/tag/')) {
    // P√°ginas de tags
    const tagName = pathname.split('/').pop();
    breadcrumbs.push({ label: 'Blog', href: '/blog', icon: 'üìù' });
    breadcrumbs.push({ label: `#${tagName}`, current: true, icon: 'üè∑Ô∏è' });
  } else if (pathname.startsWith('/blog/') && pathname !== '/blog' && pathname !== '/blog/pillars') {
    // Posts individuales (cualquier otra ruta que empiece con /blog/)
    breadcrumbs.push({ label: 'Blog', href: '/blog', icon: 'üìù' });
    breadcrumbs.push({ label: customTitle || 'Art√≠culo', current: true, icon: 'üìÑ' });
  }
}

// Home page
if (pathname === '/') {
  breadcrumbs.push({ label: 'Inicio', current: true, icon: 'üè†' });
}


---

<!-- Simple Breadcrumbs -->
{breadcrumbs.length > 0 && (
  <nav class="global-breadcrumbs" aria-label="Breadcrumb navigation">
    <ol class="global-breadcrumbs__list">
      {breadcrumbs.map((item, index) => (
        <li class="global-breadcrumbs__item">
          {item.current ? (
            <span class="global-breadcrumbs__current" aria-current="page">
              <span class="global-breadcrumbs__icon">{item.icon}</span>
              <span class="global-breadcrumbs__text">{item.label}</span>
            </span>
          ) : (
            <a
              href={item.href}
              class="global-breadcrumbs__link"
              data-breadcrumb-click={item.label}
            >
              <span class="global-breadcrumbs__icon">{item.icon}</span>
              <span class="global-breadcrumbs__text">{item.label}</span>
            </a>
          )}

          {index < breadcrumbs.length - 1 && (
            <span class="global-breadcrumbs__separator">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M6 4l4 4-4 4" stroke="currentColor" stroke-width="2" fill="none"/>
              </svg>
            </span>
          )}
        </li>
      ))}
    </ol>
  </nav>
)}

<style>
  .global-breadcrumbs {
    margin: 1rem 0;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--color-border);
    font-size: 0.875rem;
  }
  
  .global-breadcrumbs__list {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem;
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .global-breadcrumbs__item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .global-breadcrumbs__link {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: all 0.2s ease;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
  }
  
  .global-breadcrumbs__link:hover {
    color: var(--color-primary);
    background: var(--color-primary-alpha);
    text-decoration: none;
  }
  
  .global-breadcrumbs__link:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }
  
  .global-breadcrumbs__current {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    color: var(--color-text-primary);
    font-weight: 500;
    padding: 0.25rem 0.5rem;
  }
  
  .global-breadcrumbs__ellipsis {
    color: var(--color-text-tertiary);
    font-weight: 500;
    padding: 0.25rem 0.5rem;
  }
  
  .global-breadcrumbs__icon {
    font-size: 0.875em;
    line-height: 1;
  }
  
  .global-breadcrumbs__text {
    line-height: 1.2;
  }
  
  .global-breadcrumbs__separator {
    color: var(--color-text-tertiary);
    flex-shrink: 0;
    display: flex;
    align-items: center;
  }
  
  /* Separator variants */
  .global-breadcrumbs--arrow .global-breadcrumbs__separator {
    font-size: 0.75rem;
  }
  
  .global-breadcrumbs--slash .global-breadcrumbs__separator {
    font-size: 1rem;
    font-weight: 300;
  }
  
  .global-breadcrumbs--chevron .global-breadcrumbs__separator svg {
    width: 14px;
    height: 14px;
  }
  
  /* Variants */
  .global-breadcrumbs--minimal {
    margin: 0.5rem 0;
    padding: 0.5rem 0;
    border-bottom: none;
    font-size: 0.8125rem;
  }
  
  .global-breadcrumbs--minimal .global-breadcrumbs__link,
  .global-breadcrumbs--minimal .global-breadcrumbs__current {
    padding: 0.125rem 0.25rem;
  }
  
  .global-breadcrumbs--compact {
    margin: 0.25rem 0;
    padding: 0.25rem 0;
    font-size: 0.75rem;
  }
  
  .global-breadcrumbs--compact .global-breadcrumbs__list {
    gap: 0.25rem;
  }
  
  .global-breadcrumbs--compact .global-breadcrumbs__item {
    gap: 0.25rem;
  }
  
  .global-breadcrumbs--compact .global-breadcrumbs__link,
  .global-breadcrumbs--compact .global-breadcrumbs__current {
    padding: 0.125rem 0.25rem;
    gap: 0.25rem;
  }
  
  .global-breadcrumbs--compact .global-breadcrumbs__icon {
    font-size: 0.75em;
  }
  
  /* Dark mode */
  :global(.dark) .global-breadcrumbs {
    border-bottom-color: var(--color-border-dark);
  }
  
  /* Mobile responsive */
  @media (max-width: 640px) {
    .global-breadcrumbs {
      margin: 0.5rem 0;
      padding: 0.5rem 0;
      font-size: 0.8125rem;
    }
    
    .global-breadcrumbs__list {
      gap: 0.375rem;
    }
    
    .global-breadcrumbs__item {
      gap: 0.375rem;
    }
    
    .global-breadcrumbs__link,
    .global-breadcrumbs__current {
      padding: 0.125rem 0.375rem;
      gap: 0.25rem;
    }
    
    .global-breadcrumbs__separator svg {
      width: 12px;
      height: 12px;
    }
    
    /* Hide icons on very small screens */
    @media (max-width: 480px) {
      .global-breadcrumbs__icon {
        display: none;
      }
    }
  }
  
  /* High contrast mode */
  @media (prefers-contrast: high) {
    .global-breadcrumbs__link {
      text-decoration: underline;
    }
    
    .global-breadcrumbs__current {
      font-weight: 600;
    }
    
    .global-breadcrumbs {
      border-bottom-width: 2px;
    }
  }
  
  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .global-breadcrumbs__link {
      transition: none;
    }
  }
  
  /* Print styles */
  @media print {
    .global-breadcrumbs {
      border-bottom: 1px solid #ccc;
      margin-bottom: 1rem;
    }
    
    .global-breadcrumbs__link {
      color: #000;
      text-decoration: underline;
    }
    
    .global-breadcrumbs__current {
      color: #000;
      font-weight: 600;
    }
    
    .global-breadcrumbs__separator {
      color: #666;
    }
  }
  
  /* Focus management for keyboard navigation */
  .global-breadcrumbs__link:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
    border-radius: 4px;
  }
  
  /* Hover effects for better UX */
  .global-breadcrumbs__link:hover .global-breadcrumbs__icon {
    transform: scale(1.1);
    transition: transform 0.2s ease;
  }
  
  @media (prefers-reduced-motion: reduce) {
    .global-breadcrumbs__link:hover .global-breadcrumbs__icon {
      transform: none;
      transition: none;
    }
  }
</style>

<script>
  // Simple breadcrumb analytics tracking
  document.addEventListener('DOMContentLoaded', () => {
    const breadcrumbLinks = document.querySelectorAll('[data-breadcrumb-click]');

    breadcrumbLinks.forEach(link => {
      link.addEventListener('click', (event) => {
        const target = event.currentTarget as HTMLAnchorElement;
        if (!target) return;

        const breadcrumbLabel = target.getAttribute('data-breadcrumb-click');
        const href = target.getAttribute('href');

        // Track breadcrumb navigation
        if (typeof (window as any).gtag !== 'undefined') {
          // Google Analytics 4
          (window as any).gtag('event', 'breadcrumb_navigation', {
            breadcrumb_label: breadcrumbLabel,
            destination_url: href,
            page_location: window.location.href
          });
        }

        // Console log for development
        console.log('üß≠ Breadcrumb Navigation:', {
          label: breadcrumbLabel,
          destination: href,
          from: window.location.pathname
        });
      });
    });
  });
</script>
