---
import BlogNavbar from '../../components/BlogNavbar.astro';
import Footer from '../../components/Footer.astro';
import CommonScripts from '../../components/CommonScripts.astro';
import Favicons from '../../components/Favicons.astro';
import SEOHead from '../../components/SEOHead.astro';
import { getCollection } from 'astro:content';
import TagList from '../../components/TagList.astro';

// Obtener todos los posts del blog
const posts = await getCollection('blog', (post) => {
    return !post.data.draft || import.meta.env.DEV;
});

// Ordenar por fecha (más reciente primero)
posts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Extraer todas las etiquetas únicas
const allTags = [...new Set(posts.flatMap(post => post.data.tags || []))];

// Metadatos para SEO
const title = "Blog | Matías Cappato";
const description = "Artículos sobre desarrollo web, programación, tecnología y más por Matías Cappato. Aprende sobre JavaScript, React, Node.js y las últimas tendencias en desarrollo.";
---

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    <SEOHead 
        title={title}
        description={description}
        image="/images/blog-cover.webp"
        imageAlt="Blog de Matías Cappato sobre desarrollo web y tecnología"
        type="website"
        keywords={["blog", "desarrollo web", "programación", "javascript", "react", "node.js"]}
    />
    <Favicons />
    <CommonScripts />
    <link rel="stylesheet" href="/styles/blog.css">
</head>
<body class="bg-gray-900 text-gray-100 font-sans">
    <BlogNavbar currentPath="/blog" />
    
    <main class="container mx-auto px-4 py-8">
        <header class="mb-12 text-center">
            <h1 class="text-4xl font-bold mb-4 text-primary">Blog</h1>
            <p class="text-xl text-gray-300 max-w-2xl mx-auto">{description}</p>
        </header>

        <!-- Filtro por etiquetas -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-4">Explorar por tema</h2>
            <div class="flex flex-wrap gap-2">
                {allTags.map(tag => (
                    <a href={`/blog/tag/${tag}`} class="bg-gray-800 hover:bg-gray-700 text-secondary px-3 py-1 rounded-md transition">
                        #{tag}
                    </a>
                ))}
            </div>
        </section>
        
        <!-- Lista de posts -->
        <section>
            <h2 class="text-2xl font-bold mb-6">Artículos recientes</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {posts.map(post => (
                    <article class="bg-gray-800 rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow">
                        <a href={`/blog/${post.data.slug || post.slug}`} class="block">
                            {post.data.postId ? (
                                <img 
                                    src={`/images/${post.data.postId}/portada-thumb.webp`} 
                                    alt={post.data.imageAlt || post.data.title}
                                    class="w-full h-48 object-cover"
                                    loading="lazy"
                                    width="600"
                                    height="315"
                                />
                            ) : post.data.image ? (
                                <img 
                                    src={post.data.image.url} 
                                    alt={post.data.image.alt || post.data.title}
                                    class="w-full h-48 object-cover"
                                    loading="lazy"
                                    width="600"
                                    height="315"
                                />
                            ) : (
                                <div class="w-full h-48 bg-gray-700 flex items-center justify-center">
                                    <span class="text-gray-400">Sin imagen</span>
                                </div>
                            )}
                        </a>
                        
                        <div class="p-4">
                            <h3 class="text-xl font-bold mb-2">
                                <a href={`/blog/${post.data.slug || post.slug}`} class="text-primary hover:underline">
                                    {post.data.title}
                                </a>
                            </h3>
                            
                            <p class="text-gray-300 text-sm mb-3">
                                {new Date(post.data.date).toLocaleDateString('es-ES', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                })}
                            </p>
                            
                            <p class="text-gray-400 mb-4 line-clamp-3">
                                {post.data.description}
                            </p>
                            
                            {post.data.tags && (
                                <TagList tags={post.data.tags} />
                            )}
                            
                            <a href={`/blog/${post.data.slug || post.slug}`} class="mt-4 inline-block text-primary hover:underline text-sm font-medium">
                                Leer más →
                            </a>
                        </div>
                    </article>
                ))}
            </div>
        </section>
    </main>
    
    <Footer />
</body>
</html>


